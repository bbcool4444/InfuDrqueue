<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Geometry Caching</title>
<meta http-equiv="content-type" content="text/html; charset=us-ascii" />
<meta name="author" content="mental images GmbH" />
<link href="mailto:office@mentalimages.com" rev="made" />
<link href="mental.css" rel="stylesheet" media="all" type="text/css" />
<link rel="shortcut icon" href="mentalicon.ico" type="image/x-icon" />
</head>
<body>

<ul class="nav">
<li><a href="index.html">home</a></li>
<li><a href="node6.html">&laquo;&nbsp;prev</a></li>
<li><a href="database.html">next&nbsp;&raquo;</a></li>
<li><a href="globalindex.html">index</a></li>
</ul>

<a id="SECTION5"></a>

<h3 id="fo:geometry_cache">Geometry Caching</h3>

<p>For optimal execution of tasks in parallel, also known as
<dfn id="fo:load_balancing">load balancing</dfn>, it is essential to subdivide
the entire rendering operation into small tasks, which are called
<dfn id="fo:jobs">jobs</dfn> in mental ray. Jobs may perform a wide variety of
operations: tessellating a portion of a surface, loading a portion of a texture,
casting a bundle of rays, rendering a section of the image, balancing a
<a href="node48.html#INDEX96"> photon map</a>, and many others.</p>
<p>mental ray is executing jobs on demand, managed by a dependency graph of
jobs. For example, a job is executed only when another job accesses data
generated by that job. The data generated by jobs enters a memory pool,
traditionally called the <i>geometry cache</i>. This cache manages almost
all data stored in memory by mental ray, including textures, photons, images,
and more. Data can not only enter the cache but may also be deleted when
memory fills up and the data has not been used for a while, and it is known
that the source data is available or can be recreated at any time. This is
handled by mental ray <a href="#fo:memory">memory management</a>.</p>
<p>Dynamic job execution and the geometry cache as the central hub of
mental ray has several advantages:</p>
<ul>
<li>rendering begins almost immediately, instead of having to wait
for the completion of a possibly large number of preparation jobs.</li>
<li>data that is not used will not be computed. For example, typically
only parts of shadow maps are ever actually used; mental ray may only
compute those parts instead of creating the entire shadow map. Also,
in fly-through scenes, only parts of the scene may actually be used
for rendering (if global illumination effects are not enabled).</li>
<li>not all data is used at the same time. Data enters the cache when needed,
and may get displaced later when memory fills up. Memory usage rises smoothly
up to the defined <a href="#fo:memory_limit">memory limit</a>, and then will
try to stay there.</li>
<li>parallelism is enhanced, because threads no longer become idle
near the end of each phase. Job execution is completely independent of
(host) location and of other jobs, and can be freely scheduled all over
the network to make use of available resources.</li>
<li>if the complexity of the scene exceeds the capacity of the system,
the system performance degrades gracefully instead of "hitting the wall"
by failing or excessive disk swapping.</li>
</ul>
<p>In general, geometry caching has the effect of exploiting scene coherence
very effectively. mental ray achieves significantly higher speed at noticeable
memory usage reduction compared to previous generation. Unlike traditional
geometry caching methods, this advantage is not limited to specific scenes;
it works with all aspects of mental ray including
<a href="node102.html#INDEX390">ray tracing</a> and
<a href="node48.html#INDEX95">global illumination</a>. It works better if the scene
does have a high degree of coherence, but advantages remain even for
less-coherent scenes. For example, scenes that make extensive use of global
illumination, which by definition is global and less coherent, may require a
larger cache but will still benefit from its use.</p>

<a id="fo:memory"></a>
<h3>Memory Management</h3>
<p>
The memory management system in mental ray allows efficient use of the memory
resources available on the rendering machine, and provides the basis for the
capability to render huge scenes on systems with limited memory. Any memory
that is allocated in mental ray core and in shaders (using the memory
shader interface functions) will be registered in the memory module together
with other essential information. This permits to watch overall consumption
and to react to progress and failure conditions during rendering.
<p>The primary control to tune memory usage in mental ray is the
<dfn id="fo:memory_limit">memory limit</dfn>. It is predefined on 32bit
systems to about 1GB to work well in most existing systems, and unlimited
on 64bit systems. It may be set to any other value, and even to "unlimited"
in special cases. In the "unlimited" case, mental ray is fully depending on
the operating system to provide memory, and starts to intervene only when the
system fails to allocate. However, in this case, typically very little
resources are left to perform clean-up procedures in reasonable time, and
mental ray's attempt to survive the bottleneck and finish the current rendering
may take a long time or fail anyway. Setting the limit too high has a similar
effect. On the other hand, tuning down the limit can help to render a huge scene
successfully, at the expense of reducing the performance noticeably (due to
releasing and re-creating pieces of the scene). It is best practice to model
scene elements in smaller pieces instead of creating huge concrete objects,
and to utilize callback mechanisms like <a href="node83.html#mi:object_file">
object placeholder</a> and <a href="assembly.html"> assemblies</a> whenever
possible, to benefit most from the memory management system.
<p>The memory limit may be adjusted globally by a
<a href="node72.html#mi:_mi_reg">registry variable</a>, or overridden for a
specific rendering by a <a href="node245.html#cli:memory">command line</a>
option.</p>

<ul class="nav">
<li><a href="index.html">home</a></li>
<li><a href="node6.html">&laquo;&nbsp;prev</a></li>
<li><a href="database.html">next&nbsp;&raquo;</a></li>
<li><a href="globalindex.html">index</a></li>
</ul>
<p><a href="copyright.html">Copyright</a> &copy; 1986-2010 by
<a href="http://www.mental.com">mental images GmbH</a></p>
</body>
</html>