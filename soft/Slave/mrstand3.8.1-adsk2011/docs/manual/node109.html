<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>User Fields</title>
<meta http-equiv="content-type" content="text/html; charset=us-ascii" />
<meta name="author" content="mental images GmbH" />
<link href="mailto:office@mentalimages.com" rev="made" />
<link href="mental.css" rel="stylesheet" media="all" type="text/css" />
<link rel="shortcut icon" href="mentalicon.ico" type="image/x-icon" />
</head>
<body>
<ul class="nav">
<li><a href="index.html">home</a></li>
<li><a href="node108.html">&laquo;&nbsp;prev</a></li>
<li><a href="node110.html">next&nbsp;&raquo;</a></li>
<li><a href="globalindex.html">index</a></li>
</ul>

<h3 id="SECTION107">User Fields</h3>

<p>Finally, the user field allows a shader to store a pointer to an
arbitrary data structure in the shader. Subsequent shaders called
as a result of operations done by this shader (such as casting a
reflection ray or evaluating a light or a texture) inherit the
pointer and can read and write this shader's local data.
Sub-shaders can also find other parent's user data by following
state parent pointers, see above. With this method, extra
parameters can be provided to and extra return values received from
sub-shaders.</p>
<p>However, once the shader that has set the <b id="INDEX410">user
pointer</b> returns, the user pointer is lost. Its purpose is to pass
information to sub-shaders down the call graph, not to pass information
from one invocation of a shader to the next (for example, to the next
primary ray). This implies that it is not a good idea to use
<i><a href="node155.html#INDEX794">mi_mem_allocate</a></i> to obtain
the pointer because by definition this could result in millions of
allocations, which is inefficient. Long-term shader user data
should be stored in the shader user pointer (obtainable with the
<tt>miQ_FUNC_USERPTR</tt> mode of
<i><a href="miquery.html#api:mi_query">mi_query</a></i>) instead,
typically allocated in the <a href="node159.html#INDEX835">init shader</a>
and released in the <a href="node159.html#INDEX836">exit shader</a>.</p>
<p>The user variables are initialized to 0.</p>
<p><a id="INDEX411"></a></p>
<div align="center">
<table class="table">
<tr>
<th><i>type</i></th>
<th><i>name</i></th>
<th><i>content</i></th>
</tr>
<tr>
<td><tt>void *</tt></td>
<td><tt>user</tt></td>
<td>user data pointer</td>
</tr>
<tr>
<td><tt>int</tt></td>
<td><tt>user_size</tt></td>
<td>user data size (optional)</td>
</tr>
</table>
</div>

<ul class="nav">
<li><a href="index.html">home</a></li>
<li><a href="node108.html">&laquo;&nbsp;prev</a></li>
<li><a href="node110.html">next&nbsp;&raquo;</a></li>
<li><a href="globalindex.html">index</a></li>
</ul>
<p>
<a href="copyright.html">Copyright</a> &copy; 1986-2010 by
<a href="http://www.mental.com">mental images GmbH</a></p>
</body>
</html>